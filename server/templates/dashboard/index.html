{% include 'base.html' %}

{% block script %}
 <!-- Icons -->
 <script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script>
 <script>
    $(document).ready(function() { feather.replace(); });

    function getData(test_device_0, callback_success, callback_error) {
        var apiUrl = "{{ url_for('api_get', device_id='DEVICE_ID') }}".replace('DEVICE_ID',test_device_0);
        $.ajax({
                dataType: "json",
                url: apiUrl,
                data: {
                    start: moment().utc().subtract(1, 'minutes').format(),
                    end: moment().utc().format(),
                    fill: "null",
                    interval: 1,
                    limit: 30,
                },
                success: callback_success,
                error: callback_error
        }); 
    }

    function getDevices(callback_success, callback_error) {
        var apiUrl = "{{ url_for('api_get_devices') }}";
        $.ajax({
                dataType: "json",
                url: apiUrl,
                success: callback_success,
                error: callback_error
        }); 
    }

    function update() {
        console.log("UPDATE");
        // getData(test_device_0, function() {
        // });
    }

    $(document).ready(function() {

        $(".device-link").click(function() {
            console.log(["data-device-id", $(this).data('device-id') ]);
            var is_active = $(this).find('.nav-link').first().hasClass('active');
            if (is_active) {
                // Deactivate this and all children
                $(this).find('.nav-link').removeClass('active');
            } else {
                // Activate this only
                $(this).find('.nav-link').first().addClass('active');
            }
        });
        
        $(".field-link").click(function() {
            console.log(["data-device-id", $(this).data('device-id') ]);
            $(this).toggleClass('active');
        });


        // setInterval(update, 2500);

        getDevices(function(resp) {
            console.log(resp);
            $('#menu').html('');
            for (i in resp.devices) {
                var device = resp.registered[i]
                console.log(device);
                $('#menu').append('<li>'+device.name+'</li>');
            }
        }, null);
    });
</script>
{% endblock %}



{% block content %}

    <nav class="col-md-2 d-none d-md-block bg-light sidebar">   
        <div class="sidebar-sticky">
            <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
              <span>Devices</span>
              <a class="d-flex align-items-center text-muted" href="{{ url_for('device_register') }}">
                <span data-feather="plus-circle"> </span> &nbsp;Register
              </a>
            </h6>
            <ul id="menu"></ul>
        </div>
    </nav>

    <main role="main" class="col-md-9 ml-sm-auto col-lg-10 pt-3 px-4">
        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom">
        <h1 class="h2">Dashboard</h1>
        <div class="btn-toolbar mb-2 mb-md-0">
            <!-- <div class="btn-group mr-2">
            <button class="btn btn-sm btn-outline-secondary">Share</button>
            <button class="btn btn-sm btn-outline-secondary">Export</button>
            </div> -->
                  
                <div class="form-group">
                    <div class='input-group date' id='datetimepicker_start'>
                        <input type='text' class="form-control" />
                        <span class="input-group-addon">
                            <span class="glyphicon glyphicon-calendar"></span>
                        </span>
                    </div>
                </div>
           
                <div class="form-group">
                    <div class='input-group date' id='datetimepicker_end'>
                        <input type='text' class="form-control" />
                        <span class="input-group-addon">
                            <span class="glyphicon glyphicon-calendar"></span>
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </main>
{% endblock %}
