{% extends 'system/base.html' %}
{% import 'macros.html' as b_wtf %}

{% block title %}Logs{% endblock %}

{% block menu %}
{% with active = 'logs' %}
{% include 'system/menu.html' %}
{% endwith %}
{% endblock %}

{% block script %}
<script>
  $(document).ready(function() { 
    $('.pagination-link').click(function(e) {
      e.preventDefault();
      $('#offset').val( $(this).data('goto') * $('#limit').val() );
      $('#filter').submit();
    });
  });
  
</script>
{% endblock %}

{% block style %}
<style>
  .cat-funcexec {
    color: blue;
  }
  .cat-interaction {
    color: green;
  }
  .cat-error {
    color: red;
  }
  .cat-debug {
    color: purple;
  }
  .pagination, .pagination li {
    margin: 0!important;
  }
</style>
{% endblock %}

{% block pagination %}
  {% if logdata.num_pages > 1 %}
    <ul class="pagination justify-content-end">
      {% if logdata.page_num > 1 %}
      <li class="page-item"><a class="page-link pagination-link" data-goto="{{ logdata.page_num - 2 }}" href="#">Previous</a></li>
      {% endif %}
      {% for i in range(1, logdata.num_pages+1) %}
        {% if i > logdata.page_num - 4 and i < logdata.page_num + 4 %}
        <li class="page-item {{ 'active' if logdata.page_num == i else '' }}">
          <a class="page-link pagination-link" href="#" data-goto="{{ i - 1 }}">{{ i }}</a>
        </li>
        {% endif %}
      {% endfor %}
      {% if logdata.page_num < logdata.num_pages %}
      <li class="page-item"><a class="page-link pagination-link" data-goto="{{ logdata.page_num  }}" href="#">Next</a></li>
      {% endif %}
    </ul>

  {% endif %}
{% endblock %}

{% block content %}
<div class="card">
  <div class="card-body">
    <form id="filter" class="form-inline" action="{{ url_for('.logs') }}" method="POST">
        {{form.hidden_tag()}}
        <div class="form-row align-items-baseline">
          <div class="">
              {{ b_wtf.bootstrap_field(form.start, label=True, horizontal=True) }}    
          </div>
          <div class="">
              {{ b_wtf.bootstrap_field(form.end, label=True, horizontal=True) }}    
          </div>
          <div class="">
              {{ b_wtf.bootstrap_field(form.cat, label=True, horizontal=True) }}    
          </div>
          <div class="">
              {{ b_wtf.bootstrap_field(form.limit, label=True, horizontal=True) }}    
          </div>
          <div class="">
            {{ b_wtf.bootstrap_field(form.offset, label=True, horizontal=True) }}    
          </div>
          <div class="">
              {{ b_wtf.bootstrap_field(form.orderby, label=True, horizontal=True) }}    
            </div>
            <button type="submit" class="btn btn-primary">Filter</button>
        </div>
      </form>
    </div>
    <div class="card-footer">
      <div class="row">
        <div class="col">Showing results {{ logdata.page_start }} to {{ logdata.page_end }} of {{ logdata.total }} | Page {{ logdata.page_num }} of {{ logdata.num_pages }}</div>
        <div class="col justify-content-end">{{ self.pagination() }}</div>
      </div>
    </div>
  </div>
<BR>    
<table class="table table-bordered">
    <thead>
      <tr>
        <th>Date & Time</th>
        <th>Category</th>
        <th>Message</th>
        <th>Extra</th>
      </tr>
    </thead>
    <tbody>
        {% for ld in logdata.results %}
        <tr>
            <td>{{ ld.time }}</td>
            <td class="cat-{{ ld.category }}"><strong>{{ ld.category }}</strong></td>
            <td>{{ ld.message }}</td>
            <td>{{ ld.extra }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{{ self.pagination() }}
<BR>
{% endblock %}